(()=>{var t,e,i=t=>{throw TypeError(t)},n=(t,e,n)=>e.has(t)?i("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),o=(t,e,n)=>(((t,e)=>{e.has(t)||i("Cannot access private method")})(t,e),n),s=class{constructor(e,i){n(this,t),this.name=e,this.version=i,this.t=null,this.i="bm-h",this.o=null,this.m=null,this.l=[]}u(t){this.t=t}h(){return this.l.length>0&&(this.m=this.l.pop()),this}p(t){t?.appendChild(this.o),this.o=null,this.m=null,this.l=[]}v(i={},n=()=>{}){return n(this,o(this,t,e).call(this,"div",{},i)),this}$(i={},n=()=>{}){return n(this,o(this,t,e).call(this,"p",{},i)),this}M(i={},n=()=>{}){return n(this,o(this,t,e).call(this,"small",{},i)),this}D(i={},n=()=>{}){return n(this,o(this,t,e).call(this,"img",{},i)),this}T(i,n={},s=()=>{}){return s(this,o(this,t,e).call(this,"h"+i,{},n)),this}k(i={},n=()=>{}){return n(this,o(this,t,e).call(this,"hr",{},i)),this}C(i={},n=()=>{}){return n(this,o(this,t,e).call(this,"br",{},i)),this}S(i={},n=()=>{}){const s=o(this,t,e).call(this,"label",{textContent:i.textContent??""});delete i.textContent;const r=o(this,t,e).call(this,"input",{type:"checkbox"},i);return s.insertBefore(r,s.firstChild),this.h(),n(this,s,r),this}N(i={},n=()=>{}){return n(this,o(this,t,e).call(this,"button",{},i)),this}B(i={},n=()=>{}){const s=i.title??i.textContent??"Help: No info";delete i.textContent,i.title=`Help: ${s}`;const r={textContent:"?",className:"bm-w",onclick:()=>{this.O(this.i,s)}};return n(this,o(this,t,e).call(this,"button",r,i)),this}L(i={},n=()=>{}){return n(this,o(this,t,e).call(this,"input",{},i)),this}I(i={},n=()=>{}){const s=i.textContent??"";delete i.textContent;const r=o(this,t,e).call(this,"div"),a=o(this,t,e).call(this,"input",{type:"file",style:"display: none !important; visibility: hidden !important; position: absolute !important; left: -9999px !important; width: 0 !important; height: 0 !important; opacity: 0 !important;"},i);this.h();const m=o(this,t,e).call(this,"button",{textContent:s});return this.h(),this.h(),a.setAttribute("tabindex","-1"),a.setAttribute("aria-hidden","true"),m.addEventListener("click",()=>{a.click()}),a.addEventListener("change",()=>{m.style.maxWidth=`${m.offsetWidth}px`,a.files.length>0?m.textContent=a.files[0].name:m.textContent=s}),n(this,r,a,m),this}P(i={},n=()=>{}){return n(this,o(this,t,e).call(this,"textarea",{},i)),this}O(t,e,i=!1){const n=document.getElementById(t.replace(/^#/,""));n&&(n instanceof HTMLInputElement?n.value=e:i?n.textContent=e:n.innerHTML=e)}R(t,e){let i,n=!1,o=0,s=null,r=0,a=0,m=0,c=0;if(t=document.querySelector("#"==t?.[0]?t:"#"+t),e=document.querySelector("#"==e?.[0]?e:"#"+e),!t||!e)return void this.j(`Can not drag! ${t?"":"moveMe"} ${t||e?"":"and "}${e?"":"iMoveThings "}was not found!`);const l=()=>{if(n){const e=Math.abs(r-m),i=Math.abs(a-c);(e>.5||i>.5)&&(r=m,a=c,t.style.transform=`translate(${r}px, ${a}px)`,t.style.left="0px",t.style.top="0px",t.style.right=""),s=requestAnimationFrame(l)}};let u=null;const d=(d,h)=>{n=!0,u=t.getBoundingClientRect(),i=d-u.left,o=h-u.top;const b=window.getComputedStyle(t).transform;if(b&&"none"!==b){const t=new DOMMatrix(b);r=t.m41,a=t.m42}else r=u.left,a=u.top;m=r,c=a,document.body.style.userSelect="none",e.classList.add("dragging"),s&&cancelAnimationFrame(s),l()},h=()=>{n=!1,s&&(cancelAnimationFrame(s),s=null),document.body.style.userSelect="",e.classList.remove("dragging")};e.addEventListener("mousedown",function(t){t.preventDefault(),d(t.clientX,t.clientY)}),e.addEventListener("touchstart",function(t){const e=t?.touches?.[0];e&&(d(e.clientX,e.clientY),t.preventDefault())},{passive:!1}),document.addEventListener("mousemove",function(t){n&&u&&(m=t.clientX-i,c=t.clientY-o)},{passive:!0}),document.addEventListener("touchmove",function(t){if(n&&u){const e=t?.touches?.[0];if(!e)return;m=e.clientX-i,c=e.clientY-o,t.preventDefault()}},{passive:!1}),document.addEventListener("mouseup",h),document.addEventListener("touchend",h),document.addEventListener("touchcancel",h)}A(t){(0,console.info)(`${this.name}: ${t}`),this.O(this.i,"Status: "+t,!0)}j(t){(0,console.error)(`${this.name}: ${t}`),this.O(this.i,"Error: "+t,!0)}};function r(t,e){if(0===t)return e[0];let i="";const n=e.length;for(;t>0;)i=e[t%n]+i,t=Math.floor(t/n);return i}function a(t){let e="";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function m(t){const e=atob(t),i=new Uint8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.charCodeAt(t);return i}t=new WeakSet,e=function(t,e={},i={}){const n=document.createElement(t);this.o?(this.m?.appendChild(n),this.l.push(this.m),this.m=n):(this.o=n,this.m=n);for(const[t,i]of Object.entries(e))n[t]=i;for(const[t,e]of Object.entries(i))n[t]=e;return n};var c,l,u,d,h=[{id:0,premium:!1,name:"Transparent",rgb:[0,0,0]},{id:1,premium:!1,name:"Black",rgb:[0,0,0]},{id:2,premium:!1,name:"Dark Gray",rgb:[60,60,60]},{id:3,premium:!1,name:"Gray",rgb:[120,120,120]},{id:4,premium:!1,name:"Light Gray",rgb:[210,210,210]},{id:5,premium:!1,name:"White",rgb:[255,255,255]},{id:6,premium:!1,name:"Deep Red",rgb:[96,0,24]},{id:7,premium:!1,name:"Red",rgb:[237,28,36]},{id:8,premium:!1,name:"Orange",rgb:[255,127,39]},{id:9,premium:!1,name:"Gold",rgb:[246,170,9]},{id:10,premium:!1,name:"Yellow",rgb:[249,221,59]},{id:11,premium:!1,name:"Light Yellow",rgb:[255,250,188]},{id:12,premium:!1,name:"Dark Green",rgb:[14,185,104]},{id:13,premium:!1,name:"Green",rgb:[19,230,123]},{id:14,premium:!1,name:"Light Green",rgb:[135,255,94]},{id:15,premium:!1,name:"Dark Teal",rgb:[12,129,110]},{id:16,premium:!1,name:"Teal",rgb:[16,174,166]},{id:17,premium:!1,name:"Light Teal",rgb:[19,225,190]},{id:18,premium:!1,name:"Dark Blue",rgb:[40,80,158]},{id:19,premium:!1,name:"Blue",rgb:[64,147,228]},{id:20,premium:!1,name:"Cyan",rgb:[96,247,242]},{id:21,premium:!1,name:"Indigo",rgb:[107,80,246]},{id:22,premium:!1,name:"Light Indigo",rgb:[153,177,251]},{id:23,premium:!1,name:"Dark Purple",rgb:[120,12,153]},{id:24,premium:!1,name:"Purple",rgb:[170,56,185]},{id:25,premium:!1,name:"Light Purple",rgb:[224,159,249]},{id:26,premium:!1,name:"Dark Pink",rgb:[203,0,122]},{id:27,premium:!1,name:"Pink",rgb:[236,31,128]},{id:28,premium:!1,name:"Light Pink",rgb:[243,141,169]},{id:29,premium:!1,name:"Dark Brown",rgb:[104,70,52]},{id:30,premium:!1,name:"Brown",rgb:[149,104,42]},{id:31,premium:!1,name:"Beige",rgb:[248,178,119]},{id:32,premium:!0,name:"Medium Gray",rgb:[170,170,170]},{id:33,premium:!0,name:"Dark Red",rgb:[165,14,30]},{id:34,premium:!0,name:"Light Red",rgb:[250,128,114]},{id:35,premium:!0,name:"Dark Orange",rgb:[228,92,26]},{id:36,premium:!0,name:"Light Tan",rgb:[214,181,148]},{id:37,premium:!0,name:"Dark Goldenrod",rgb:[156,132,49]},{id:38,premium:!0,name:"Goldenrod",rgb:[197,173,49]},{id:39,premium:!0,name:"Light Goldenrod",rgb:[232,212,95]},{id:40,premium:!0,name:"Dark Olive",rgb:[74,107,58]},{id:41,premium:!0,name:"Olive",rgb:[90,148,74]},{id:42,premium:!0,name:"Light Olive",rgb:[132,197,115]},{id:43,premium:!0,name:"Dark Cyan",rgb:[15,121,159]},{id:44,premium:!0,name:"Light Cyan",rgb:[187,250,242]},{id:45,premium:!0,name:"Light Blue",rgb:[125,199,255]},{id:46,premium:!0,name:"Dark Indigo",rgb:[77,49,184]},{id:47,premium:!0,name:"Dark Slate Blue",rgb:[74,66,132]},{id:48,premium:!0,name:"Slate Blue",rgb:[122,113,196]},{id:49,premium:!0,name:"Light Slate Blue",rgb:[181,174,241]},{id:50,premium:!0,name:"Light Brown",rgb:[219,164,99]},{id:51,premium:!0,name:"Dark Beige",rgb:[209,128,81]},{id:52,premium:!0,name:"Light Beige",rgb:[255,197,165]},{id:53,premium:!0,name:"Dark Peach",rgb:[155,82,73]},{id:54,premium:!0,name:"Peach",rgb:[209,128,120]},{id:55,premium:!0,name:"Light Peach",rgb:[250,182,164]},{id:56,premium:!0,name:"Dark Tan",rgb:[123,99,82]},{id:57,premium:!0,name:"Tan",rgb:[156,132,107]},{id:58,premium:!0,name:"Dark Slate",rgb:[51,57,65]},{id:59,premium:!0,name:"Slate",rgb:[109,117,141]},{id:60,premium:!0,name:"Light Slate",rgb:[179,185,209]},{id:61,premium:!0,name:"Dark Stone",rgb:[109,100,63]},{id:62,premium:!0,name:"Stone",rgb:[148,140,107]},{id:63,premium:!0,name:"Light Stone",rgb:[205,197,158]}],b=class{constructor({displayName:t="My template",F:e=0,q:i="",url:n="",file:o=null,coords:s=null,U:r=null,W:a=1e3}={}){this.displayName=t,this.F=e,this.q=i,this.url=n,this.file=o,this.coords=s,this.U=r,this.W=a,this.H=0,this.G=0,this.V=0,this.J={},this.Y=new Set,this._=null;const m=Array.isArray(h)?h:[];this.X=new Set(m.filter(t=>"transparent"!==(t?.name||"").toLowerCase()&&Array.isArray(t?.rgb)).map(t=>`${t.rgb[0]},${t.rgb[1]},${t.rgb[2]}`));const c="222,250,206";this.X.add(c);const l="other";this.X.add(l),this.Z=new Map(m.filter(t=>Array.isArray(t?.rgb)).map(t=>[`${t.rgb[0]},${t.rgb[1]},${t.rgb[2]}`,{id:t.id,premium:!!t.premium,name:t.name}]));try{const t=m.find(t=>"transparent"===(t?.name||"").toLowerCase());t&&Array.isArray(t.rgb)&&this.Z.set(c,{id:t.id,premium:!!t.premium,name:t.name})}catch(t){}try{this.Z.set(l,{id:"other",premium:!1,name:"Other"})}catch(t){}}async K(){const t=await createImageBitmap(this.file),e=t.width,i=t.height,n=e*i;this.H=n;try{const n=new OffscreenCanvas(e,i).getContext("2d",{tt:!0});n.imageSmoothingEnabled=!1,n.clearRect(0,0,e,i),n.drawImage(t,0,0);const o=n.getImageData(0,0,e,i).data;let s=0,r=0;const a=new Map;for(let t=0;t<i;t++)for(let i=0;i<e;i++){const n=4*(t*e+i),m=o[n],c=o[n+1],l=o[n+2];if(0===o[n+3])continue;222===m&&250===c&&206===l&&r++;const u=this.X.has(`${m},${c},${l}`)?`${m},${c},${l}`:"other";s++,a.set(u,(a.get(u)||0)+1)}this.G=s,this.V=r;const m={};for(const[t,e]of a.entries())m[t]={count:e,enabled:!0};this.J=m}catch(t){this.G=Math.max(0,this.H),this.V=0}const o={},s={},r=new OffscreenCanvas(this.W,this.W),m=r.getContext("2d",{tt:!0});for(let n=this.coords[3];n<i+this.coords[3];){const c=Math.min(this.W-n%this.W,i-(n-this.coords[3]));for(let i=this.coords[2];i<e+this.coords[2];){const l=Math.min(this.W-i%this.W,e-(i-this.coords[2])),u=3*l,d=3*c;r.width=u,r.height=d,m.imageSmoothingEnabled=!1,m.clearRect(0,0,u,d),m.drawImage(t,i-this.coords[2],n-this.coords[3],l,c,0,0,3*l,3*c);const h=m.getImageData(0,0,u,d);for(let t=0;t<d;t++)for(let e=0;e<u;e++){const i=4*(t*u+e);if(222===h.data[i]&&250===h.data[i+1]&&206===h.data[i+2])(e+t)%2==0?(h.data[i]=0,h.data[i+1]=0,h.data[i+2]=0):(h.data[i]=255,h.data[i+1]=255,h.data[i+2]=255),h.data[i+3]=32;else if(e%3!=1||t%3!=1)h.data[i+3]=0;else{const t=h.data[i],e=h.data[i+1],n=h.data[i+2];this.X.has(`${t},${e},${n}`)}}m.putImageData(h,0,0);const b=`${(this.coords[0]+Math.floor(i/1e3)).toString().padStart(4,"0")},${(this.coords[1]+Math.floor(n/1e3)).toString().padStart(4,"0")},${(i%1e3).toString().padStart(3,"0")},${(n%1e3).toString().padStart(3,"0")}`;o[b]=await createImageBitmap(r),this.Y.add(b.split(",").slice(0,2).join(","));const p=await r.convertToBlob(),g=await p.arrayBuffer(),f=Array.from(new Uint8Array(g));s[b]=a(f),i+=l}n+=c}return{et:o,it:s}}};c=new WeakSet,l=async function(){localStorage.setItem("BMbmTemplates",JSON.stringify(this.nt))},u=async function(t){const e=t.templates;if(Object.keys(e).length>0){for(const t in e){const i=t,n=e[t];if(e.hasOwnProperty(t)){const t=i.split(" "),o=Number(t?.[0]),s=t?.[1]||"0",r=n.name||`Template ${o||""}`,a=n.tiles,c={};let l=0;const u=new Map;for(const t in a)if(a.hasOwnProperty(t)){const e=m(a[t]),i=new Blob([e],{type:"image/png"}),n=await createImageBitmap(i);c[t]=n;try{const t=n.width,e=n.height,i=new OffscreenCanvas(t,e).getContext("2d",{tt:!0});i.imageSmoothingEnabled=!1,i.clearRect(0,0,t,e),i.drawImage(n,0,0);const o=i.getImageData(0,0,t,e).data;for(let i=0;i<e;i++)for(let e=0;e<t;e++){if(e%this.ot!==1||i%this.ot!==1)continue;const n=4*(i*t+e),s=o[n],r=o[n+1],a=o[n+2];if(o[n+3]<64)continue;if(222===s&&250===r&&206===a)continue;l++;const m=activeTemplate.X.has(`${s},${r},${a}`)?`${s},${r},${a}`:"other";u.set(m,(u.get(m)||0)+1)}}catch(t){}}const d=new b({displayName:r,F:o||this.st?.length||0,q:s||""});d.U=c,d.G=l;const h={};for(const[t,e]of u.entries())h[t]={count:e,enabled:!0};d.J=h;try{Object.keys(c).forEach(t=>{d.Y?.add(t.split(",").slice(0,2).join(","))})}catch(t){}try{const t=e?.[i]?.palette;if(t)for(const[e,i]of Object.entries(t))d.J[e]?d.J[e].enabled=!!i?.enabled:d.J[e]={count:i?.count||0,enabled:!!i?.enabled}}catch(t){}d._=i,this.st.push(d)}}try{const t=document.querySelector("#bm-4");t&&(t.style.display=""),window.postMessage({source:"blue-marble",rt:"bm-6"},"*")}catch(t){}}},d=new WeakSet,window.BM_meta={name:"Blue Marble",ct:"https://github.com/SwingTheVine/",version:"0.86.0",description:"A userscript to automate and/or enhance the user experience on Wplace.live. Make sure to comply with the site's Terms of Service, and rules! This script is not affiliated with Wplace.live in any way, use at your own risk. This script is not affiliated with TamperMonkey. The author of this userscript is not responsible for any damages, issues, loss of data, or punishment that may occur as a result of using this script. This script is provided 'as is' under the MPL-2.0 license. The 'Blue Marble' icon is licensed under CC0 1.0 Universal (CC0 1.0) Public Domain Dedication. The image is owned by NASA.",lt:"SwingTheVine",ut:"MPL-2.0",dt:"https://discord.gg/tpeBPy46hf",ht:"https://bluemarble.lol/",icon:"https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/30256c4535ef239f287a8b09caa5fcdd8161ad5d/dist/assets/Favicon.png",bt:"https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/main/dist/BlueMarble.user.js",gt:"https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/main/dist/BlueMarble.user.js",match:"https://wplace.live/*"};var p=window.BM_meta.name,g=window.BM_meta.version;!function(t){const e=document.createElement("script");e.setAttribute("bm-x",p),e.setAttribute("bm-u","color: cornflowerblue;"),e.textContent=`(${t})();`,document.documentElement?.appendChild(e),e.remove()}(()=>{window.originalFetch=window.fetch;const t=document.currentScript,e=t?.getAttribute("bm-x")||"Blue Marble",i=t?.getAttribute("bm-u")||"",n=new Map;window.addEventListener("message",t=>{const{source:o,endpoint:s,blobID:r,blobData:a,blink:m}=t.data;if(Date.now(),"blue-marble"==o&&r&&a&&!s){const t=n.get(r);"function"==typeof t?t(a):function(...t){(0,console.warn)(...t)}(`%c${e}%c: Attempted to retrieve a blob (%s) from queue, but the blobID was not a function! Skipping...`,i,"",r),n.delete(r)}});const o=window.fetch;window.fetch=async function(...t){const e=await o.apply(this,t),i=e.clone(),s=(t[0]instanceof Request?t[0]?.url:t[0])||"ignore",r=i.headers.get("content-type")||"";if(r.includes("application/json"))i.json().then(t=>{window.postMessage({source:"blue-marble",endpoint:s,jsonData:t},"*")}).catch(t=>{});else if(r.includes("image/")&&!s.includes("openfreemap")&&!s.includes("maps")){const t=Date.now(),e=await i.blob();return new Promise(o=>{const r=crypto.randomUUID();n.set(r,t=>{o(new Response(t,{headers:i.headers,status:i.status,statusText:i.statusText}))}),window.postMessage({source:"blue-marble",endpoint:s,blobID:r,blobData:e,blink:t})}).catch(t=>{Date.now()})}return e}});var f=document.createElement("link");f.href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap",f.rel="preload",f.as="style",f.onload=function(){this.onload=null,this.rel="stylesheet"},document.head?.appendChild(f),new class{constructor(){this.ft=null,this.wt=null,this.yt="#bm-a"}vt(t){return this.wt=t,this.ft=new MutationObserver(t=>{for(const e of t)for(const t of e.addedNodes)t instanceof HTMLElement&&t.matches?.(this.yt)}),this}xt(){return this.ft}observe(t,e=!1,i=!1){t.observe(this.wt,{childList:e,subtree:i})}};var w=new s(p,g),y=(new s(p,g),new class{constructor(t,e,i){n(this,c),this.name=t,this.version=e,this.o=i,this.$t="1.0.0",this.Mt=null,this.Dt="!#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~",this.W=1e3,this.ot=3,this.Tt=null,this.kt=null,this.Ct="bm-v",this.St="div#map canvas.maplibregl-canvas",this.Nt=null,this.Bt="",this.st=[],this.nt=null,this.Ot=!0,this.Lt=new Map}It(){if(document.body.contains(this.Tt))return this.Tt;document.getElementById(this.Ct)?.remove();const t=document.querySelector(this.St),e=document.createElement("canvas");return e.id=this.Ct,e.className="maplibregl-canvas",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.height=t?.clientHeight*(window.devicePixelRatio||1)+"px",e.style.width=t?.clientWidth*(window.devicePixelRatio||1)+"px",e.height=t?.clientHeight*(window.devicePixelRatio||1),e.width=t?.clientWidth*(window.devicePixelRatio||1),e.style.zIndex="8999",e.style.pointerEvents="none",t?.parentElement?.appendChild(e),this.Tt=e,window.addEventListener("move",this.Pt),window.addEventListener("zoom",this.Rt),window.addEventListener("resize",this.jt),this.Tt}async At(){return{whoami:this.name.replace(" ",""),scriptVersion:this.version,schemaVersion:this.$t,templates:{}}}async Ft(t,e,i){this.nt||(this.nt=await this.At()),this.o.A(`Creating template at ${i.join(", ")}...`);const n=new b({displayName:e,F:0,q:r(this.Mt||0,this.Dt),file:t,coords:i}),{et:s,it:a}=await n.K(this.W);n.U=s;const m=`${n.F} ${n.q}`;n._=m,this.nt.templates[m]={name:n.displayName,coords:i.join(", "),enabled:!0,tiles:a,palette:n.J},this.st=[],this.st.push(n);const u=(new Intl.NumberFormat).format(n.H);this.o.A(`Template created at ${i.join(", ")}! Total pixels: ${u}`);try{const t=document.querySelector("#bm-4");t&&(t.style.display=""),window.postMessage({source:"blue-marble",rt:"bm-6"},"*")}catch(t){}await o(this,c,l).call(this)}qt(){}async Et(){this.nt||(this.nt=await this.At())}async Ut(t,e){if(!this.Ot)return t;const i=this.W*this.ot;e=e[0].toString().padStart(4,"0")+","+e[1].toString().padStart(4,"0");const n=this.st;if(n.sort((t,e)=>t.F-e.F),!n.some(t=>!!t?.U&&(t.Y&&t.Y.size>0?t.Y.has(e):Object.keys(t.U).some(t=>t.startsWith(e)))))return t;const o=n.map(t=>{const i=Object.keys(t.U).filter(t=>t.startsWith(e));if(0===i.length)return null;const n=i.map(e=>{const i=e.split(",");return{Wt:t.U[e],Ht:[i[0],i[1]],Gt:[i[2],i[3]]}});return n?.[0]}).filter(Boolean),s=o?.length||0;let r=0,a=0,m=0;const c=await createImageBitmap(t),l=new OffscreenCanvas(i,i),u=l.getContext("2d");u.imageSmoothingEnabled=!1,u.beginPath(),u.rect(0,0,i,i),u.clip(),u.clearRect(0,0,i,i),u.drawImage(c,0,0,i,i);let d=null;try{d=u.getImageData(0,0,i,i).data}catch(t){}for(const t of o){if(d)try{const e=t.Wt.width,n=t.Wt.height,o=new OffscreenCanvas(e,n).getContext("2d",{tt:!0});o.imageSmoothingEnabled=!1,o.clearRect(0,0,e,n),o.drawImage(t.Wt,0,0);const s=o.getImageData(0,0,e,n).data,c=Number(t.Gt[0])*this.ot,l=Number(t.Gt[1])*this.ot;for(let t=0;t<n;t++)for(let n=0;n<e;n++){if(n%this.ot!==1||t%this.ot!==1)continue;const o=n+c,u=t+l;if(o<0||u<0||o>=i||u>=i)continue;const h=4*(t*e+n),b=s[h],p=s[h+1],g=s[h+2];if(s[h+3]<64){try{const t=this.st?.[0],e=4*(u*i+o),n=d[e],s=d[e+1],r=d[e+2],m=d[e+3],c=t.X.has(`${n},${s},${r}`)?`${n},${s},${r}`:"other",l=!!t?.X&&t.X.has(c);m>=64&&l&&a++}catch(t){}continue}m++;const f=4*(u*i+o),w=d[f],y=d[f+1],v=d[f+2];d[f+3]<64||(w===b&&y===p&&v===g?r++:a++)}}catch(t){}try{const e=this.st?.[0],i=e?.J||{};if(Object.values(i).some(t=>!1===t?.enabled)){const n=t.Wt.width,o=t.Wt.height,s=new OffscreenCanvas(n,o),r=s.getContext("2d",{tt:!0});r.imageSmoothingEnabled=!1,r.clearRect(0,0,n,o),r.drawImage(t.Wt,0,0);const a=r.getImageData(0,0,n,o),m=a.data;for(let t=0;t<o;t++)for(let o=0;o<n;o++){if(o%this.ot!==1||t%this.ot!==1)continue;const s=4*(t*n+o),r=m[s],a=m[s+1],c=m[s+2];if(m[s+3]<1)continue;let l=e.X.has(`${r},${a},${c}`)?`${r},${a},${c}`:"other";(!e?.X||e.X.has(l))&&!1!==i?.[l]?.enabled||(m[s+3]=0)}r.putImageData(a,0,0),u.drawImage(s,Number(t.Gt[0])*this.ot,Number(t.Gt[1])*this.ot)}else u.drawImage(t.Wt,Number(t.Gt[0])*this.ot,Number(t.Gt[1])*this.ot)}catch(e){u.drawImage(t.Wt,Number(t.Gt[0])*this.ot,Number(t.Gt[1])*this.ot)}}if(s>0){const t=e;this.Lt.set(t,{zt:r,required:m,Vt:a});let i=0,n=0,o=0;for(const t of this.Lt.values())i+=t.zt||0,n+=t.required||0,o+=t.Vt||0;const c=this.st.reduce((t,e)=>t+(e.G||e.H||0),0),l=c>0?c:n,u=(new Intl.NumberFormat).format(i),d=(new Intl.NumberFormat).format(l),h=(new Intl.NumberFormat).format(l-i);this.o.A(`Displaying ${s} template${1==s?"":"s"}.\nPainted ${u} / ${d} â€¢ Wrong ${h}`)}else this.o.A(`Displaying ${s} templates.`);return await l.convertToBlob({type:"image/png"})}Jt(t){"BlueMarble"==t?.whoami&&o(this,c,u).call(this,t)}Yt(t){this.Ot=t}}(p,g,w)),v=new class{constructor(t){n(this,d),this._t=t,this.Xt=!1,this.Zt=[],this.Kt=[]}Qt(t){window.addEventListener("message",async e=>{const i=e.data,n=i.jsonData;if(!i||"blue-marble"!==i.source)return;if(!i.endpoint)return;const o=i.endpoint?.split("?")[0].split("/").filter(t=>t&&isNaN(Number(t))).filter(t=>t&&!t.includes(".")).pop();switch(o){case"me":if(n.status&&"2"!=n.status?.toString()[0])return void t.j("You are not logged in!\nCould not fetch userdata.");const e=Math.ceil(Math.pow(Math.floor(n.level)*Math.pow(30,.65),1/.65)-n.pixelsPainted);n.id||n.id,this._t.Mt=n.id,t.O("bm-n",`Username: <b>${function(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}(n.name)}</b>`),t.O("bm-i",`Droplets: <b>${(new Intl.NumberFormat).format(n.droplets)}</b>`),t.O("bm-b",`Next level in <b>${(new Intl.NumberFormat).format(e)}</b> pixel${1==e?"":"s"}`);break;case"pixel":const o=i.endpoint.split("?")[0].split("/").filter(t=>t&&!isNaN(Number(t))),a=new URLSearchParams(i.endpoint.split("?")[1]),m=[a.get("x"),a.get("y")];if(this.Zt.length&&(!o.length||!m.length))return void t.j("Coordinates are malformed!\nDid you try clicking the canvas first?");this.Zt=[...o,...m];const c=(s=o,r=m,[parseInt(s[0])%4*1e3+parseInt(r[0]),parseInt(s[1])%4*1e3+parseInt(r[1])]),l=document.querySelectorAll("span");for(const t of l)if(t.textContent.trim().includes(`${c[0]}, ${c[1]}`)){let e=document.querySelector("#bm-a");const i=`(Tl X: ${o[0]}, Tl Y: ${o[1]}, Px X: ${m[0]}, Px Y: ${m[1]})`;e?e.textContent=i:(e=document.createElement("span"),e.id="bm-a",e.textContent=i,e.style="margin-left: calc(var(--spacing)*3); font-size: small;",t.parentNode.parentNode.parentNode.insertAdjacentElement("afterend",e))}break;case"tiles":let u=i.endpoint.split("/");u=[parseInt(u[u.length-2]),parseInt(u[u.length-1].replace(".png",""))];const d=i.blobID,h=i.blobData,b=await this._t.Ut(h,u);window.postMessage({source:"blue-marble",blobID:d,blobData:b,blink:i.blink});break;case"robots":this.Xt="false"==n.userscript?.toString().toLowerCase()}var s,r})}async te(t){}}(y);w.u(v);var x=(t,e="{}")=>{let i=localStorage.getItem("BM_"+t);return null===i?e:i},$=(t,e)=>{localStorage.setItem("BM_"+t,e)},M=JSON.parse(x("bmTemplates","{}"));y.Jt(M);var D=JSON.parse(x("bmUserSettings","{}"));if(0==Object.keys(D).length){const t=crypto.randomUUID();$("bmUserSettings",JSON.stringify({uuid:t}))}setInterval(()=>v.te(g),18e5),function(){let t=!1,e={};try{e=JSON.parse(x("bmCoords","{}"))||{}}catch(t){e={}}const i=()=>{try{const t=Number(document.querySelector("#bm-o")?.value||""),e=Number(document.querySelector("#bm-p")?.value||""),i={ee:t,ie:e,px:Number(document.querySelector("#bm-q")?.value||""),ne:Number(document.querySelector("#bm-r")?.value||"")};$("bmCoords",JSON.stringify(i))}catch(t){}};w.v({id:"bm-t",style:"top: 10px; right: 75px;"}).v({id:"bm-c"}).v({id:"bm-s"}).h().D({alt:"Blue Marble Icon - Click to minimize/maximize",src:"https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/main/dist/assets/Favicon.png",style:"cursor: pointer;"},(e,i)=>{i.addEventListener("click",()=>{t=!t;const n=document.querySelector("#bm-t"),o=document.querySelector("#bm-c"),s=document.querySelector("#bm-s"),r=document.querySelector("#bm-d"),a=document.querySelector("#bm-j"),m=document.querySelector("#bm-k"),c=document.querySelector("#bm-l"),l=document.querySelector("#bm-e"),u=document.querySelectorAll("#bm-d input");t||(n.style.width="auto",n.style.maxWidth="300px",n.style.minWidth="200px",n.style.padding="10px"),["#bm-t h1","#bm-8","#bm-t hr","#bm-7 > *:not(#bm-d)","#bm-5","#bm-3",`#${e.i}`,"#bm-4"].forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.style.display=t?"none":""})}),t?(r&&(r.style.display="none"),a&&(a.style.display="none"),m&&(m.style.display="none"),c&&(c.style.display="none"),l&&(l.style.display="none"),u.forEach(t=>{t.style.display="none"}),n.style.width="60px",n.style.height="76px",n.style.maxWidth="60px",n.style.minWidth="60px",n.style.padding="8px",i.style.marginLeft="3px",o.style.textAlign="center",o.style.margin="0",o.style.marginBottom="0",s&&(s.style.display="",s.style.marginBottom="0.25em")):(r&&(r.style.display="",r.style.flexDirection="",r.style.justifyContent="",r.style.alignItems="",r.style.gap="",r.style.textAlign="",r.style.margin=""),a&&(a.style.display=""),m&&(m.style.display="",m.style.marginTop=""),c&&(c.style.display="",c.style.marginTop=""),l&&(l.style.display="",l.style.marginTop=""),u.forEach(t=>{t.style.display=""}),i.style.marginLeft="",n.style.padding="10px",o.style.textAlign="",o.style.margin="",o.style.marginBottom="",s&&(s.style.marginBottom="0.5em"),n.style.width="",n.style.height=""),i.alt=t?"Blue Marble Icon - Minimized (Click to maximize)":"Blue Marble Icon - Maximized (Click to minimize)"})}).h().T(1,{textContent:p}).h().h().k().h().v({id:"bm-8"}).$({id:"bm-n",textContent:"Username:"}).h().$({id:"bm-i",textContent:"Droplets:"}).h().$({id:"bm-b",textContent:"Next level in..."}).h().h().k().h().v({id:"bm-7"}).v({id:"bm-d"}).N({id:"bm-j",className:"bm-w",style:"margin-top: 0;",innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 6"><circle cx="2" cy="2" r="2"></circle><path d="M2 6 L3.7 3 L0.3 3 Z"></path><circle cx="2" cy="2" r="0.7" fill="white"></circle></svg></svg>'},(t,e)=>{e.onclick=()=>{const e=t.t?.Zt;e?.[0]?(t.O("bm-o",e?.[0]||""),t.O("bm-p",e?.[1]||""),t.O("bm-q",e?.[2]||""),t.O("bm-r",e?.[3]||""),i()):t.j("Coordinates are malformed! Did you try clicking on the canvas first?")}}).h().L({type:"number",id:"bm-o",placeholder:"Tl X",min:0,max:2047,step:1,required:!0,value:e.ee??""},(t,e)=>{e.addEventListener("paste",t=>{let e=(t.clipboardData||window.clipboardData).getData("text").split(" ").filter(t=>t).map(Number).filter(t=>!isNaN(t));if(4!==e.length)return;let i=(n=document,coords=[],coords.push(n.querySelector("#bm-o")),coords.push(n.querySelector("#bm-p")),coords.push(n.querySelector("#bm-q")),coords.push(n.querySelector("#bm-r")),coords);var n;for(let t=0;t<i.length;t++)i[t].value=e[t];t.preventDefault()});const n=()=>i();e.addEventListener("input",n),e.addEventListener("change",n)}).h().L({type:"number",id:"bm-p",placeholder:"Tl Y",min:0,max:2047,step:1,required:!0,value:e.ie??""},(t,e)=>{const n=()=>i();e.addEventListener("input",n),e.addEventListener("change",n)}).h().L({type:"number",id:"bm-q",placeholder:"Px X",min:0,max:2047,step:1,required:!0,value:e.px??""},(t,e)=>{const n=()=>i();e.addEventListener("input",n),e.addEventListener("change",n)}).h().L({type:"number",id:"bm-r",placeholder:"Px Y",min:0,max:2047,step:1,required:!0,value:e.ne??""},(t,e)=>{const n=()=>i();e.addEventListener("input",n),e.addEventListener("change",n)}).h().h().v({id:"bm-4",style:"max-height: 140px; overflow: auto; border: 1px solid rgba(255,255,255,0.1); padding: 4px; border-radius: 4px; display: none;"}).v({style:"display: flex; gap: 6px; margin-bottom: 6px;"}).N({id:"bm-1",textContent:"Enable All"},(t,e)=>{e.onclick=()=>{const e=y.st[0];e?.J&&(Object.values(e.J).forEach(t=>t.enabled=!0),buildColorFilterList(),t.A("Enabled all colors"))}}).h().N({id:"bm-0",textContent:"Disable All"},(t,e)=>{e.onclick=()=>{const e=y.st[0];e?.J&&(Object.values(e.J).forEach(t=>t.enabled=!1),buildColorFilterList(),t.A("Disabled all colors"))}}).h().h().v({id:"bm-9"}).h().h().I({id:"bm-5",textContent:"Upload Template",accept:"image/png, image/jpeg, image/webp, image/bmp, image/gif"}).h().v({id:"bm-2"}).N({id:"bm-l",textContent:"Enable"},(t,e)=>{e.onclick=()=>{t.t?._t?.Yt(!0),t.A("Enabled templates!")}}).h().N({id:"bm-k",textContent:"Create"},(t,e)=>{e.onclick=()=>{const e=document.querySelector("#bm-5"),i=document.querySelector("#bm-o");if(!i.checkValidity())return i.reportValidity(),void t.j("Coordinates are malformed! Did you try clicking on the canvas first?");const n=document.querySelector("#bm-p");if(!n.checkValidity())return n.reportValidity(),void t.j("Coordinates are malformed! Did you try clicking on the canvas first?");const o=document.querySelector("#bm-q");if(!o.checkValidity())return o.reportValidity(),void t.j("Coordinates are malformed! Did you try clicking on the canvas first?");const s=document.querySelector("#bm-r");if(!s.checkValidity())return s.reportValidity(),void t.j("Coordinates are malformed! Did you try clicking on the canvas first?");e?.files[0]?(y.Ft(e.files[0],e.files[0]?.name.replace(/\.[^/.]+$/,""),[Number(i.value),Number(n.value),Number(o.value),Number(s.value)]),t.A("Drew to canvas!")):t.j("No file selected!")}}).h().N({id:"bm-e",textContent:"Disable"},(t,e)=>{e.onclick=()=>{t.t?._t?.Yt(!1),t.A("Disabled templates!")}}).h().h().P({id:w.i,placeholder:`Status: Sleeping...\nVersion: ${g}`,readOnly:!0}).h().v({id:"bm-3"}).v().N({id:"bm-f",className:"bm-w",innerHTML:"ðŸŽ¨",title:"Template Color Converter"},(t,e)=>{e.addEventListener("click",()=>{window.open("https://pepoafonso.github.io/color_converter_wplace/","_blank","noopener noreferrer")})}).h().N({id:"bm-g",className:"bm-w",innerHTML:"ðŸŒ",title:"Official Blue Marble Website"},(t,e)=>{e.addEventListener("click",()=>{window.open("https://bluemarble.lol/","_blank","noopener noreferrer")})}).h().h().M({textContent:"Made by SwingTheVine",style:"margin-top: auto;"}).h().h().h().p(document.body),window.buildColorFilterList=function(){const t=document.querySelector("#bm-9"),e=y.st?.[0];if(!t||!e?.J)return void(t&&(t.innerHTML="<small>No template colors to display.</small>"));t.innerHTML="";const i=Object.entries(e.J).sort((t,e)=>e[1].count-t[1].count);for(const[e,n]of i){let i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.gap="8px",i.style.margin="4px 0";let o=document.createElement("div");o.style.width="14px",o.style.height="14px",o.style.border="1px solid rgba(255,255,255,0.5)";let s=document.createElement("span");s.style.fontSize="12px";let r=`${n.count.toLocaleString()}`;if("other"===e)o.style.background="#888",r=`Other â€¢ ${r}`;else if("#deface"===e)o.style.background="#deface",r=`Transparent â€¢ ${r}`;else{const[t,i,n]=e.split(",").map(Number);o.style.background=`rgb(${t},${i},${n})`;try{const o=y.st?.[0]?.Z?.get(e);if(o&&"number"==typeof o.id){const e=o?.name||`rgb(${t},${i},${n})`,s=o.premium?"â˜… ":"";r=`#${o.id} ${s}${e} â€¢ ${r}`}}catch(t){}}s.textContent=r;const a=document.createElement("input");a.type="checkbox",a.checked=!!n.enabled,a.addEventListener("change",()=>{n.enabled=a.checked,w.A(`${a.checked?"Enabled":"Disabled"} ${e}`);try{const t=y.st?.[0],e=t?._;t&&e&&y.nt?.templates?.[e]&&(y.nt.templates[e].palette=t.J,localStorage.setItem("BMbmTemplates",JSON.stringify(y.nt)))}catch(t){}}),i.appendChild(a),i.appendChild(o),i.appendChild(s),t.appendChild(i)}},window.addEventListener("message",t=>{if("bm-6"===t?.data?.rt)try{buildColorFilterList()}catch(t){}}),setTimeout(()=>{try{if(y.st?.length>0){const t=document.querySelector("#bm-4");t&&(t.style.display=""),buildColorFilterList()}}catch(t){}},0)}(),w.R("#bm-t","#bm-s"),v.Qt(w),new MutationObserver((t,e)=>{const i=document.querySelector("#color-1");if(!i)return;let n=document.querySelector("#bm-m");if(!n){n=document.createElement("button"),n.id="bm-m",n.textContent="Move â†‘",n.className="btn btn-soft",n.onclick=function(){const t=this.parentNode.parentNode.parentNode.parentNode,e="Move â†‘"==this.textContent;t.parentNode.className=t.parentNode.className.replace(e?"bottom":"top",e?"top":"bottom"),t.style.borderTopLeftRadius=e?"0px":"var(--radius-box)",t.style.borderTopRightRadius=e?"0px":"var(--radius-box)",t.style.borderBottomLeftRadius=e?"var(--radius-box)":"0px",t.style.borderBottomRightRadius=e?"var(--radius-box)":"0px",this.textContent=e?"Move â†“":"Move â†‘"};const t=i.parentNode.parentNode.parentNode.parentNode.querySelector("h2");t.parentNode?.appendChild(n)}}).observe(document.body,{childList:!0,subtree:!0}),function(...t){(0,console.log)(...t)}(`%c${p}%c (${g}) userscript has loaded!`,"color: cornflowerblue;","")})();